{
    "body": "i'm a very happy user of exmh, but i'm paranoid also :-)\ntherefore i'm not too happy with exmh caching my pgp passphrases.\n\nusually i use a relatively secure tool called 'quintuple agent' \n to store my passphrases,\nand i've just added the few lines of code to exmh which allow for such\nexternal caches.\n\nthe patch is attached, it is against version 2.5-1 (debian), and the\nfiles modified are extrasInit.tcl and pgpExec.tcl.\n\ni've added three new preferences in the 'general pgp' section, which\nallow everybody to use his/her favourite external tool to get the\npassphrase (everything which spits out the phrase on stdout is ok).\n\ni'd be happy if somebody with cvs access thinks that this stuff \nis worth to be added and does so; apart from that i'm happy for \nsuggestions, comments or critique (mind you, i'm not exactly a special \nfriend of tcl so my code may leave things to be desired...)\n\nregards\naz\n\n\n--- /usr/lib/exmh/extrasInit.tcl Sat Mar 2 17:26:38 2002\n+++ ./extrasInit.tcl Fri Sep 27 14:22:13 2002\n@@ -642,6 +642,18 @@\n {pgp(passtimeout) pgpPassTimeout 60 {Minutes to cache PGP passphrase}\n \"Exmh will clear its memory of PGP passphrases after\n this time period, in minutes, has elapsed.\" }\n+{pgp(extpass) pgpExtPass OFF {Use external passphrase cache}\n+\"If this is enabled, then exmh will use an external program to retrieve \n+your passphrase when needed. pgpKeepPass and pgpPassTimeout will \n+be ignored.\"}\n+{pgp(getextcmd) pgpGetExtCmd {/usr/bin/q-client get %s} {Method to query external passphrase cache}\n+\"This external program is used to retrieve the passphrase for your key,\n+if pgpExtPass is active. The passphrase is expected on stdout.\n+The key id is substituted with %s (using format).\" }\n+{pgp(delextcmd) pgpDelExtCmd {/usr/bin/q-client delete %s} {Method to invalidate external passphrase cache}\n+\"This external program is used to delete the passphrase for your key\n+from the external cache, if pgpExtPass is active. \n+The key id is substituted with %s (using format).\" }\n }\n \n # Make sure we don't inherit a bad pgp(version) from a previous setup\n--- /usr/lib/exmh/pgpExec.tcl Sat Mar 2 17:26:39 2002\n+++ ./pgpExec.tcl Fri Sep 27 14:19:40 2002\n@@ -647,6 +647,33 @@\n proc Pgp_GetPass { v key } {\n global pgp\n \n+ if {[info exists pgp(extpass)] && [set pgp(extpass)] \\\n+ && [info exists pgp(getextcmd)]} {\n+ Exmh_Debug \"Pgp_GetPass $v $key external\"\n+ set keyid [lindex $key 0]\n+ set cmd [format $pgp(getextcmd) $keyid]\n+ while (1) {\n+ Exmh_Debug \"running cmd $cmd\"\n+ if [ catch {exec sh -c \"$cmd\"} result ] {\n+ Exmh_Debug \"error running cmd: $result\"\n+ Exmh_Status \"Error executing external cmd\" warn\n+ return {}\n+ } else {\n+ if {[Pgp_Exec_CheckPassword $v $result $key]} {\n+ return $result\n+ } else {\n+ Exmh_Debug \"bad passphrase\"\n+ if {[info exists pgp(delextcmd)]} {\n+ Exmh_Debug \"trying to invalidate bad passphrase\"\n+ if [catch {exec sh -c \"[format $pgp(delextcmd) $keyid]\"}] {\n+ Exmh_Debug \"invalidation failed\"\n+ return {}\n+ }\n+ }\n+ }\n+ }\n+ }\n+ } else {\n Exmh_Debug \"Pgp_GetPass $v $key\"\n \n if {[lsearch -glob [set pgp($v,privatekeys)] \"[lindex $key 0]*\"] ", 
    "to": [
        "exmh-users@spamassassin.taint.org"
    ], 
    "is_spam": false, 
    "from": "Alexander Zangerl <az@snafu.priv.at>", 
    "subject": "exmh and pgp: support for external passphrase cache (+patch)"
}