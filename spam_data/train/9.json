{
    "body": "I did more testing with your patch on top of today's CVS, but the patch\ndidn't help at all.\nThe following is the results of the tests:\n\nTesting setup:\n1. created a \"/dev/md0\" with 4 scsi disks\n2. created a LVM Volume group \"vg\" with the \"/dev/md0\"\n3. created a LVM logical volume \"vol1\" with \"vg\"\n4. created a XFS fs with a command:\n mkfs.xfs -f -d sunit=8,swidth=8 /dev/vg/vol1\n -----------meta-data=/dev/vg/vol1 isize=256 agcount=8,\nagsize=32767 blks\n -----------data = bsize=4096 blocks=262136,\nimaxpct=25\n ----------- = sunit=1 swidth=1 blks,\nunwritten=0\n -----------naming =version 2 bsize=4096\n -----------log =internal log bsize=4096 blocks=1200,\nversion=1\n ----------- = sunit=1 blks\n -----------realtime =none extsz=65536 blocks=0,\nrtextents=0\n\nTest results:\n1. mount with quota enabled => occasional kernel oops, attached the file\noops1\n2. mount without quota enabled => occasional kernel oops, attached the file\noops2\n3. mount without quota enabled, while md device is in degraded mode =>\nalways kernel oops, attached the file oops3\n\nThanks,\n\nJLee\n\n----- Original Message -----\nFrom: \"Eric Sandeen\" \nTo: \"James Lee\" \nCc: ; \nSent: Tuesday, August 13, 2002 3:03 PM\nSubject: Re: kernel BUG at filemap.c:843!\n\n\n> Hi guys -\n>\n> We treat MD and LVM somewhat specially, and I wonder if in this case MD\n> is masking the fact that you're using LVM, and that might be where the\n> problem starts.\n>\n> Can you try this patch, which will cause LVM & MD to be treated the\n> same, to see if it helps? It's probably not the final solution, but it\n> might offer some hints.\n>\n> Thanks,\n>\n> -Eric\n>\n> --- linux/fs/xfs/pagebuf/page_buf_locking.c_1.24 Tue Aug 13 14:05:18 2002\n> +++ linux/fs/xfs/pagebuf/page_buf_locking.c Tue Aug 13 13:59:37 2002\n> @@ -198,7 +196,7 @@\n> pagebuf_target_blocksize(target, PAGE_CACHE_SIZE);\n>\n> if ((MAJOR(dev) == MD_MAJOR) || (MAJOR(dev) == EVMS_MAJOR))\n> - target->pbr_flags = PBR_ALIGNED_ONLY;\n> + target->pbr_flags = PBR_SECTOR_ONLY;\n> else if (MAJOR(dev) == LVM_BLK_MAJOR)\n> target->pbr_flags = PBR_SECTOR_ONLY;\n> else\n>\n>\n>\n> On Mon, 2002-08-12 at 01:40, James Lee wrote:\n> > Hi,\n> >\n> > I'm also having the exactly same problem.\n> > Tested with 2.4.19-xfs(checked out from SGI's CVS on Aug 10) on Redhat\n7.2.\n> > Kernel and userland tools are compiled with gcc 2.91.66\n> > The following is the result of some tests:\n> >\n> > scsidisks -> xfs: OK\n> > scsidisks -> raid5 -> xfs: OK\n> > scsidisks -> lvm -> xfs: OK\n> > scsidisks -> raid0 -> lvm -> xfs: OK\n> > scsidisks -> raid1 -> lvm -> xfs: OK\n> > scsidisks -> raid5 -> lvm -> xfs: kernel BUG at filemap.c:843!\n> >\n> > This problem is always reproducible with the following shell script:\n> >\n> > #!/bin/sh\n> > mkraid /dev/md0\n> > vgcreate VolumeGroup /dev/md0\n> > lvcreate -L1G -nTestVolume VolumeGroup\n> > mkfs.xfs -f -d size=32m /dev/VolumeGroup/TestVolume\n> > mount -t xfs /dev/VolumeGroup/TestVolume\n> > /mnt -onoatime,nodiratime,usrquota,grpquota\n> >\n> > Whenever I run the above script, mount command always generates kernel\noops.\n> > But, if I insert some delay as of the following, then mount goes well:\n>\n>\n> --\n> Eric Sandeen XFS for Linux http://oss.sgi.com/projects/xfs\n> sandeen@sgi.com SGI, Inc. 651-683-3102\n\n\nbegin 666 oops1.dat\nM=&5S=&5D.B R+C0N,3DM>&9S(\"A31TDG 7-T96T@8W)E871E9\"!O;B!T;W @;V8@\nM3%9-(\"L@340L('-O;65T:6UE 6UO;W!S(#(N-\"XQ(&]N(&DV.#8@,BXT+C$Y+B @3W!T:6]N 7-T\nM96TN;6%P+3(N-\"XQ.2 H9&5F875L=\"D*\"E=A 6UB;VP@:6YF;W)M871I;VXN(\"!)\nM('=I;&P*87-S=6UE('1H870@=&AE(&QO9R!M871C:&5S('1H92!K97)N96P@\nM86YD(&UO9'5L97,@=&AA=\"!A 6UO;W!S(\"UT(&5L9C,R+6DS.#8@\nM+6$@:3,X-@I%1DQ!1U,Z(# P,#$P,C0V\"F5A>#H@8S$Y969B-# @(\"!E8G@Z\nM(&,P,V$W9#$T(\" @96-X.B P,# P,# Q-B @(&5D>#H@,# P,# P,# *97-I\nM.B!C,6,P,&5C8R @(&5D:3H@9C5F,F9F,C @(\"!E8G Z(# P,# P,# Q(\" @\nM97-P.B!F-6-D,3DY. ID 2MA8R\\Q,3 ^\"E1R86-E.R!C,#(T-C4X.2 \\&9S7W)E861?8G5F*S-E+V8P\nM/@I4 &9S7W)E861S8BLX,\"]C,#X*5')A8V4[(&,P,C-B960T(#QX9G-?8VUO=6YT\nM9G,K-3 7-T96U?8V%L;\"LS,R\\S.#X*0V]D93L@(&,P,3)B9&0V(#QU;FQO8VM?\nM&9F9F9F9F5A*\"5E8W@I+\"5E8W@*0V]D93L@(&,P\nM,3)B9&1C(#QU;FQO8VM?#0H)65S:2DL)65A> I#;V1E.R @8S Q\nM,F)D93$@/'5N;&]C:U]P86=E*S4Q+S &9S(\"A31TDG 7-T96T@=VET:\"!Q=6]T82!E;F%B;&5D\nM+\"!C &9S(\"UF(\"UD('-U;FET/3@L 6]U(&-A;B!G970*;6]R92!A8V-U '!L86EN #H@8S S83=D\nM,30@(\"!E8W@Z(# P,# P,#$V(\" @961X.B P,# P,# P, IE &9S\nM7V)U;&MS=&%T*S%B,R]B.# ^\"E1R86-E.R!C,#%F,3,Y.2 \\>&9S7W%M7W%U\nM;W1A8VAE8VLK8SDO,34P/@I4 &9S7VUO=6YT\nM9G,K9C!B+S$P,# ^\"E1R86-E.R!C,#(S,S9B8B \\>&9S7W)E861S8BLS8B]C\nM,#X*5')A8V4[(&,P,C,S-S P(#QX9G-? 7-?;6]U;G0K830O\nM,3 P/@I4 I#;V1E.R @8S Q,F)D9#D@/'5N;&]C:U]P86=E*S0Y+S \"DL)65C> I#;V1E.R @8S Q,F)D9&,@/'5N;&]C:U]P86=E*S1C+S &]R(\" @(\"0P\nM>&,P+\"5A; I#;V1E.R @8S Q,F)D9&4@/'5N;&]C:U]P86=E*S1E+S \"PP>#0H)65S:2D*0V]D93L@(&,P,3)B9&4T(#QU;FQO8VM?#(P/B!C,#$R8F1F-B \\=6YL;V-K7W!A9V4K-C8O-S ^\"D-O\nM9&4[(\"!C,#$R8F1E-B \\=6YL;V-K7W!A9V4K-38O-S ^\"B @,3 Z(\" @-6(@\nM(\" @(\" @(\" @(\" @(\" @(\" @(\" @(\"!P;W @(\" @)65B> I#;V1E.R @8S Q\nM,F)D93 I#;V1E.R @8S Q,F)D\nM93D@/'5N;&]C:U]P86=E*S4Y+S &]R(\" @(\"5E87@L*\"5E87@I\"@H*-B!W87)N:6YG 2!N;W0@8F4@ &9S(\"A31TDG 7-T96T@8W)E871E9\"!O;B!T;W @;V8@\nM3%9-(\"L@340L('=H:6QE($U$(&ES(&EN(&1E9W)A9&5D(&UO9&4@86QW87ES\nM(&=E;F5R871E &9S(\"UF(\"UD('-U;FET/3@L 6UO;W!S(#T]/3T]\nM/3T]/3T]/3T]/3T]/3T]/0IK 6US(\"AD969A=6QT*0H@(\" @(\"UL(\"]P 6UB;VP@ 2!T96QL:6YG(&UE\nM('1H92!K97)N96P@=F5R 6US(&5T8RX@(&MS>6UO;W!S(\"UH(&5X#H@,# P,# P,38@\nM(\"!E9'@Z(# P,# P,# P\"F5S:3H@8S%C,#)A8S@@(\"!E9&DZ(&5F,#EE96,P\nM(\" @96)P.B P,# P,# P,2 @(&5S2MA8R\\Q,3 ^\"E1R86-E.R!C,#(T-C4X.2 \\&9S7W)E861S8BLR,2]C\nM,#X*5')A8V4[(&,P,C-B9#1E(#QX9G-?8VUO=6YT9G,K,V5E+S8Q,#X*5')A\nM8V4[(&,P,C-C,#!B(#QX9G-?;6]U;G0K-&(O-C ^\"E1R86-E.R!C,#(T968R\nM-B \\;&EN=F9S7W)E861? 7-?;6]U;G0K830O,3 P/@I4 I#;V1E.R @8S Q,F)D9#D@/'5N;&]C:U]P86=E\nM*S0Y+S \"DL)65C> I#;V1E.R @8S Q,F)D9&,@/'5N\nM;&]C:U]P86=E*S1C+S &]R(\" @(\"0P>&,P+\"5A; I#;V1E.R @8S Q,F)D9&4@/'5N;&]C\nM:U]P86=E*S1E+S \"PP>#0H)65S:2D*0V]D93L@(&,P,3)B9&4T(#QU\nM;FQO8VM?#(P/B!C,#$R8F1F-B \\=6YL;V-K\nM7W!A9V4K-C8O-S ^\"D-O9&4[(\"!C,#$R8F1E-B \\=6YL;V-K7W!A9V4K-38O\nM-S ^\"B @,3 Z(\" @-6(@(\" @(\" @(\" @(\" @(\" @(\" @(\" @(\"!P;W @(\" @\nM)65B> I#;V1E.R @8S Q,F)D93 I#;V1E.R @8S Q,F)D93D@/'5N;&]C:U]P86=E*S4Y+S &]R(\" @(\"5E87@L*\"5E87@I\nM\"@H]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]/3T]\n+/3T]/3T]/3T]/0H`\n`\nend", 
    "to": [
        "\"Eric Sandeen\" <sandeen@sgi.com>"
    ], 
    "is_spam": false, 
    "from": "\"James Lee\" <jlee@canada.com>", 
    "subject": "Re: kernel BUG at filemap.c:843!"
}